<html>
<head>
    <meta name="csrf_token" content="{{ csrf_token() }}" />
    <link rel='stylesheet' type='text/css' href='static/fullcalendar/fullcalendar.css' />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type='text/javascript' src='static/fullcalendar/fullcalendar.js'></script>
    
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.min.css" />
    <link rel="stylesheet" href="static/site_style.css" />
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>


    <script>
        function custom_post(url, data, other_options)
            {
            var csrftoken = $('meta[name=csrf_token]').attr('content')
            options=
                {
                type: "POST",
                url: url,
                data: data,
                beforeSend: function(xhr, settings) 
                    {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken)
                    }
                }
            options= $.extend(options, other_options)
            $.ajax(options)
            }
        
        function post_or_fail(url, data)
            {
            options={
                error: function()
                    {
                    alert('An error occurred while sending data to the server. The page will be refreshed')
                    location.reload()
                    }
                }
            custom_post(url, data, options)
            }

        function click_day(date, allDay, jsEvent, view) 
            {
            newevent= {title: 'my_user', start: date}
            date_string= $.fullCalendar.formatDate( date, 'u') //ISO8601
            post_or_fail('events', {date:date_string})
            $('#calendar').fullCalendar('renderEvent', newevent)
            }
    
        $(document).ready(
            function() 
                {
                show_login_dialog()
                $('#calendar').fullCalendar(
                    {
                    dayClick: click_day,
                    events: '/events' //json url
                    }
                    )
                }
            );
    </script>
</head>
<body>
    <h1>Collab employee vacations</h1>
    <div id='calendar'></div>
    {% include 'login-dialog.html' %}
</body>
</html>
